# 리눅스 성능 분석 시작하기 - uptime 명령어

## uptime

```shell
$ uptime
```

- 시스템의 `가동시간`, `로그인한 사용자 수`, `Load Average` 를 확인할 수 있다.

## Load Average

- 서버가 받고 있는 부하 평균을 의미한다.
- 즉, 단위 시간 동안의 `R` 과 `D` 상태의 `프로세스 개수` 를 의미한다.
    - 1분, 5분, 15분
- `Load Average` 는 상대적인 값이다.
- 두 서버의 `Load Average` 가 똑같이 `1` 이라고 해도 CPU의 개수에 따라 의미가 다르다.

## 프로세스 개수가 중요한 이유

- CPU 개수와 상관 없이 현재 프로세스 개수에 따라 `Load Average` 가 설정되기 때문이다.
    - CPU가 `1개` 이면서, 프로세스가 `2개` 인 경우 -> `Load Average = 2`
    - CPU가 `2개` 이면서, 프로세스가 `2개` 인 경우 -> `Load Average = 2`
- 즉, CPU가 1개, 2개, 4개, 6개, 8개와 상관없이 프로세스 개수가 중요하다.

## Load Average > CPU 개수

- 현재 처리 가능한 수준에 비해 `많은 수의 프로세스` 가 존재한다는 의미이다.

## CPU 개수는 어떻게 알 수 있을까?

```shell
lscpu -e
```

- `lscpu` 명령어를 사용하면 된다.

## Load Average > CPU 인 경우, 정말? 항상? 괜찮을까?

- 그럴수도 있고, 아닐 수도 있다.
- 더 중요한 것은 `R` 과 `D` 상태의 프로세스 개수를 확인해야 한다.

## R, D 상태의 프로세스 의미

- `R` 은 `CPU` 위주의 작업을 말한다. (`CPU Bound`)
- `D` 는 `I/O` 위주의 작업을 말한다. (`I/O Bound`)
- `R` 상태의 프로세스가 많다면, `CPU 개수를 늘리거나`, `스레드 개수를 조절해야 한다.`
- `D` 상태의 프로세스가 많다면, `IOPS가 높은 디바이스로 변경하거나`, `처리량을 줄인다.`

## R과 D가 많은지 어떻게 알 수 있을까?

```shell
vmstat 1
```

- `vmstat` 명령어를 사용하면 된다.
- `procs` 컬럼의 `r` 컬럼, `b` 컬럼을 확인하면 된다.
- `r` 컬럼은 `R` 상태를 의미한다. (`CPU Bound`)
- `b` 컬럼은 `D` 상태를 의미한다. (`I/O Bound`)

## 정리

- `uptime` 명령을 이용해서 얼마나 많은 부하를 받고 있는지 확인할 수 있다.
- CPU 개수보다 많은 부하를 받고 있다면, 어떤 종류의 프로세스 때문인지 확인한다.
    - `R` 상태, `D` 상태
- `vmstat` 명령의 `procs` 컬럼을 확인한다.
    - `r` 컬럼, `b` 컬럼

## 참고

- [인프런 - 리눅스 성능 분석 시작하기](https://www.inflearn.com/course/%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%84%B1%EB%8A%A5-%EB%B6%84%EC%84%9D-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/dashboard)
