# 리눅스 성능 분석 시작하기 - 트러블 슈팅 사례

## 목차

- [Nginx Miss Configuration](https://github.com/bestdevhyo1225/dev-log/blob/master/Monitoring/%EB%A6%AC%EB%88%85%EC%8A%A4_%EC%84%B1%EB%8A%A5_%EB%B6%84%EC%84%9D_%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0_%ED%8A%B8%EB%9F%AC%EB%B8%94_%EC%8A%88%ED%8C%85_%EC%82%AC%EB%A1%80.md#nginx-miss-configuration)

## Nginx Miss Configuration

### 장애 상황

- 트래픽 증가와 함께 `서버의 응답 지연` 이 발생했다.
- `응답 지연` 은 `컴퓨터 리소스 부족` 이 원인에 의해서 발생했다.

### 메트릭 수집

- `CPU Usage` : CPU 사용량이 많아서 응답을 못하는 것인가?
- `Memory Usage` : 메모리 사용량이 많아서 OOM 에러가 발생하는 것인가?

### 분석

- `top` 명령을 이용해서 `CPU Usage` 를 확인하기
- 멀티 코어의 경우, 반드시 `모든 코어의 사용률을 확인해야 한다.`
- `8개의 CPU` 중 `1개의 CPU 사용률만 100%` 인 경우, `정상이 아니다.`

### worker_processes

- nginx의 설정 중 `Worker Process` 의 개수를 설정하는 항목이다.
- `Worker Process` 는 사용자 요청을 처리하는 중요한 프로세스이다.
- `worker_processes` 값을 `1` 에서 `auto` 로 바꾸게 되면, `8개의 Worker Process` 가 생기고, `서버를 8배 늘린것과 같은 효과` 를 볼 수 있다.
    - [참고) nginx.conf 파일에서 worker_processes 기본 값은 1로 설정되어 있다.](https://github.com/nginx/nginx/blob/master/conf/nginx.conf)

### Lesson Learned

- `CPU Usage` 모니터링을 잘해야한다.
- `CPU 전체 사용률` 을 보면 안된다. 멀티 코어인 경우, `개별 CPU 사용률` 을 확인해야 한다.
    - 예시) `CPU 전체 사용률이 15%`, `CPU 8개 중에 1개만 100%` 인 경우

## 참고

- [인프런 - 리눅스 성능 분석 시작하기](https://www.inflearn.com/course/%EB%A6%AC%EB%88%85%EC%8A%A4-%EC%84%B1%EB%8A%A5-%EB%B6%84%EC%84%9D-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0/dashboard)
