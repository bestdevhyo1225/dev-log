# CPU Bound, I/O Bound

## CPU (Central Processing Unit)

- 프로세스의 명령어를 해석하고 실행하는 장치

## I/O (Input/Output)

- 파일을 읽고 쓰거나
- 네트워크의 어딘가와 데이터를 주고 받는 것
- 입출력 장치와 데이터를 주거나 받는 것

## 버스트 (Burst)

- 어떤 현상이 짧은 시간안에 집중적으로 일어나는 일

## CPU 버스트

- 프로세스가 CPU에서 한 번에 연속적으로 실행되는 시간

## I/O 버스트

- 프로세스가 I/O 작업을 요청하고, 결과를 기다리는 시간

## 프로세스의 인생?

<img width="800" alt="스크린샷 2023-06-06 오후 4 58 53" src="https://github.com/bestdevhyo1225/dev-log/assets/23515771/01628b25-44c3-4077-9f00-70e91042e413">

- `CPU 버스트` 와 `I/O 버스트` 의 연속이며, 어느 순간에 CPU에 의해 종료된다.

## CPU 버스트 길이에 따른 빈도

<img width="500" alt="스크린샷 2023-06-06 오후 5 01 11" src="https://github.com/bestdevhyo1225/dev-log/assets/23515771/859b5587-f64a-4567-852b-68659107ae83">

- 대부분 프로세스의 CPU 버스트는 `8ms` 이내에 끝난다.

## CPU Bound 프로세스

- `CPU Burst` 가 많은 프로세스
- 동영상 편집 프로그램, 머신러닝 프로그램
- I/O 작업보다 연산 작업이 많음 프로그램들
- CPU의 멀티 코어만으로도 부족해서 수천 개의 코어를 가지는 GPU를 사용하기도 한다.

## I/O Bound 프로세스

- `I/O Burst` 가 많은 프로세스
- (일반적인) 백엔드 API 서버
- 백엔드 API 서버는 캐시 서버나 DB 서버에 요청을 해서 요청한 데이터를 적당한 데이터로 가공하여 응답하는 일반적인 형태
- 캐시 서버, DB 서버 요청은 I/O 작업이다.
- `I/O 작업` 은 `네트워크를 타는 부분` 이기에 CPU에서 명령어를 몇 십개 처리되는 것보다 훨씬 더 오래걸린다.

## Goetz 사람이 2002, 2006 발표한 recommends

- CPU Bound 프로그램에서 적러한 스레드 수는 `Number of CPUs + 1`
- `스레드 수` = `CPU 코어 + 1`

## 듀얼 코어 CPU.. CPU Bound 프로그램.. 스레드 몇 개??..

> 프로세스의 스레드가 4개인 경우

<img width="800" alt="스크린샷 2023-06-06 오후 5 18 30" src="https://github.com/bestdevhyo1225/dev-log/assets/23515771/0ec93708-d66d-4790-a3bb-e1535ba2bad7">

- `T1 -> T2` 컨텍스트 스위칭, `T3 -> T4` 컨텍스트 스위칭이 발생한다.
- 컨텍스트 스위칭은 `CPU를 잡아 먹는 작업`, 즉 `오버헤드 작업` (추가적인 비용)
- 컨텍스트 스위칭에 의해 `CPU` 를 낭비하게 된다.

> 프로세스의 스레드가 2개인 경우

<img width="800" alt="스크린샷 2023-06-06 오후 5 22 38" src="https://github.com/bestdevhyo1225/dev-log/assets/23515771/a47a2a40-4d57-4408-91e8-7e8a2a712710">

- CPU 코어당 하나의 스레드만 수행되기 때문에 컨텍스트 스위칭이 발생하지 않는다.
- 컨텍스트 스위칭이 발생하지 않기 때문에 `CPU` 낭비가 발생하지 않는다.
- CPU Bound 프로그램을 구현할 때는 `스레드 갯수를 CPU 코어 갯수` 와 동일하게 하면 좋다.
- 또는 `CPU 코어 갯수 == 스레드 갯수 + 1` 를 하는게 좋다.

## I/O Bound 프로그램은 몇 개의 스레드로 구현하는 것이 적절할까?

- 딱히 가이드라인이 없고, 여러 상황에 맞춰 적절한 스레드 수를 찾아야 한다.

## 만약 API 서버가 Thread Per Request 방식이라면?

- 몇 개의 스레드들을 미리 만들어 놓을지 `여러 상황을 고려해서 결정하는 것이 필요하다.`
- API 서버의 하드웨어 스펙이 어느정도인지?
- API 서버의 `I/O Burst` 비중이 대략적으로 어느정도인지?
- 예상되는 트래픽의 패턴은 어떤지?

## 참고

- [CPU Bound, I/O Bound 설명 영상 보기](https://www.youtube.com/watch?v=qnVKEwjG_gM)
